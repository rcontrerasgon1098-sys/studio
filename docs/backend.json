{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Teleconnect Workflow application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role of the user (e.g., technician, administrator)."
        }
      },
      "required": [
        "id",
        "email",
        "role"
      ]
    },
    "WorkOrder": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WorkOrder",
      "type": "object",
      "description": "Represents a work order in the Teleconnect Workflow application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the WorkOrder entity."
        },
        "folio": {
          "type": "number",
          "description": "Autogenerated folio number for the work order."
        },
        "clientId": {
          "type": "string",
          "description": "Reference to Client. (Relationship: Client 1:N WorkOrder)"
        },
        "technicianId": {
          "type": "string",
          "description": "Reference to User (technician). (Relationship: User 1:N WorkOrder)"
        },
        "startDate": {
          "type": "string",
          "description": "Start timestamp of the work order.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End timestamp of the work order.",
          "format": "date-time"
        },
        "signalType": {
          "type": "string",
          "description": "Type of signal (Simple/Doble/Triple)."
        },
        "building": {
          "type": "string",
          "description": "Building where the work is performed."
        },
        "floor": {
          "type": "string",
          "description": "Floor where the work is performed."
        },
        "cdsCanalization": {
          "type": "string",
          "description": "CDS/Canalization details."
        },
        "isCert": {
          "type": "boolean",
          "description": "Indicates if certification is required."
        },
        "isPlan": {
          "type": "boolean",
          "description": "Indicates if a plan is required."
        },
        "connectionSwitch": {
          "type": "boolean",
          "description": "Indicates if a connection switch is required."
        },
        "hubConnection": {
          "type": "boolean",
          "description": "Indicates if a hub connection is required."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the work performed."
        },
        "techSignatureUrl": {
          "type": "string",
          "description": "URL of the technician's signature image in Firebase Storage."
        },
        "clientSignatureUrl": {
          "type": "string",
          "description": "URL of the client's signature image in Firebase Storage."
        },
        "sketchImageUrl": {
          "type": "string",
          "description": "URL of the sketch image in Firebase Storage."
        },
        "status": {
          "type": "string",
          "description": "Status of the work order (e.g., completed)."
        }
      },
      "required": [
        "id",
        "folio",
        "clientId",
        "technicianId",
        "startDate",
        "endDate",
        "signalType",
        "building",
        "floor",
        "cdsCanalization",
        "isCert",
        "isPlan",
        "connectionSwitch",
        "hubConnection",
        "description",
        "techSignatureUrl",
        "clientSignatureUrl",
        "sketchImageUrl",
        "status"
      ]
    },
    "Client": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Client",
      "type": "object",
      "description": "Represents a client in the Teleconnect Workflow application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Client entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the client."
        },
        "contact": {
          "type": "string",
          "description": "Contact information for the client."
        }
      },
      "required": [
        "id",
        "name",
        "contact"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. This collection is primarily used for authentication and user role management.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/work_orders/{workOrderId}",
        "definition": {
          "entityName": "WorkOrder",
          "schema": {
            "$ref": "#/backend/entities/WorkOrder"
          },
          "description": "Stores work orders associated with a specific technician.  Technicians can only create, read, update, and delete work orders under their own user ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the technician (User)."
            },
            {
              "name": "workOrderId",
              "description": "The unique identifier for the work order."
            }
          ]
        }
      },
      {
        "path": "/clients/{clientId}",
        "definition": {
          "entityName": "Client",
          "schema": {
            "$ref": "#/backend/entities/Client"
          },
          "description": "Stores client information. Used for referencing clients in work orders.",
          "params": [
            {
              "name": "clientId",
              "description": "The unique identifier for the client."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Documents in this collection indicate administrator privileges.  The existence of a document with a specific user ID grants admin access to all work orders. Existence over Content (EOC).",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user with administrator privileges."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support the Teleconnect Workflow application with a focus on security, scalability, and maintainability. It separates work orders based on technician ownership while providing administrators with the ability to view all work orders. The structure leverages path-based ownership for technicians and a dedicated collection for admin roles to simplify security rules and ensure authorization independence.  Specifically, authorization independence is achieved by avoiding `get()` calls in security rules. This is accomplished through structural segregation, where technician-specific work orders are stored under their user ID (`/users/{userId}/work_orders/{workOrderId}`). Access control is then based solely on the `request.auth.uid` and the document path. This structure supports the required QAPs. Technicians can only list work orders under their own user ID, and administrators can list all work orders because their role membership is checked against the `/roles_admin/{uid}` document. This structure uses segregated paths.  Work orders are segregated by technician ID, which supports secure `list` operations, as technicians can only access work orders under their specific path. Admins are granted access to all documents based on membership in the `/roles_admin/{uid}` collection.  No data is mixed, and role management is explicit. The absence of `get()` calls in security rules ensures authorization independence, as no parent data needs to be fetched to authorize access. The data model promotes clear security intent by avoiding implicit or inferred permissions based on document content."
  }
}